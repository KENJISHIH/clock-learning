<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°äºŒæ•¸å­¸ï¼šæ™‚é–“å¤§å¸«ï¼ˆä¿®å¾©ç‰ˆï¼‰</title>
    <style>
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding-top: 20px;
            padding-bottom: 40px;
            background-color: #fffbf0;
            touch-action: pan-y;
        }

        h1 { color: #d35400; margin: 0 0 15px 0; font-size: 1.5rem; }

        /* è³‡è¨Šé¢æ¿å€ */
        #diff-box {
            position: relative;
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.2rem;
            min-width: 180px;
            text-align: center;
            display: none;
            cursor: pointer;
            box-shadow: 0 4px 0 #1e8449;
            margin-bottom: 15px;
        }

        /* æ™‚é˜å®¹å™¨ */
        #clock-container {
            position: relative;
            width: 340px;
            height: 340px;
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        canvas {
            background: white;
            border-radius: 50%;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border: 8px solid #f39c12;
            cursor: pointer;
            touch-action: none;
            width: 100%;
            height: 100%;
        }

        /* æ§åˆ¶æŒ‰éˆ•å€ */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            width: 95%;
            max-width: 800px;
        }

        button {
            padding: 10px 16px;
            font-size: 1rem;
            border: none;
            border-radius: 15px;
            background-color: #3498db;
            color: white;
            box-shadow: 0 4px 0 #2980b9;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
        }

        button:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-red { background-color: #e74c3c; box-shadow: 0 4px 0 #c0392b; }
        .btn-gray { background-color: #95a5a6; box-shadow: 0 4px 0 #7f8c8d; }
        .btn-orange { background-color: #e67e22; box-shadow: 0 4px 0 #d35400; }
        .btn-purple { background-color: #9b59b6; box-shadow: 0 4px 0 #8e44ad; }
        
        button.active-mode { 
            background-color: #27ae60; 
            box-shadow: 0 4px 0 #219150; 
            border: 2px solid #f1c40f; 
        }

        /* æ•¸ä½æ™‚é–“é¡¯ç¤ºå€ */
        #digital-box {
            position: relative;
            width: 240px;
            height: 70px;
            background: #2c3e50;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        #digital-time {
            font-size: 3rem;
            color: #ecf0f1;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .mask {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #34495e;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #bdc3c7;
            font-size: 1.1rem;
            display: none;
        }
        
        /* å‡ºé¡Œå€å¡Š */
        .teacher-panel {
            background: #fff;
            padding: 15px 25px;
            border-radius: 20px;
            border: 2px dashed #bdc3c7;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .teacher-panel span { font-weight: bold; color: #7f8c8d; font-size: 1.2rem; }
        
        input[type="number"] {
            width: 60px;
            padding: 8px;
            font-size: 1.4rem;
            text-align: center;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            color: #2c3e50;
            font-weight: bold;
        }

        .helper-text { color: #7f8c8d; font-size: 1rem; margin-top: 15px; text-align: center; }

        /* iPad / å¹³æ¿ å„ªåŒ– */
        @media (min-width: 768px) {
            h1 { font-size: 2rem; margin-bottom: 25px; }
            #clock-container { width: 600px; height: 600px; }
            button { padding: 15px 25px; font-size: 1.3rem; border-radius: 20px; }
            #digital-box { width: 300px; height: 90px; }
            #digital-time { font-size: 4rem; }
            #diff-box { font-size: 1.5rem; padding: 15px 30px; }
            .teacher-panel { transform: scale(1.1); margin-top: 30px; }
        }
    </style>
</head>
<body>

    <h1>ğŸ•’ æ™‚é–“å¤§å¸«</h1>

    <div id="diff-box" onclick="toggleDiffMask()">
        <span id="diff-text">0 åˆ†é˜</span>
        <div id="diff-mask" class="mask">é»æˆ‘çœ‹ç¶“éå¤šä¹…</div>
    </div>
    
    <div id="clock-container">
        <canvas id="clock"></canvas>
    </div>

    <div id="digital-box" onclick="toggleTimeMask()">
        <span id="digital-time">12:00</span>
        <div id="time-mask" class="mask">é»æˆ‘çœ‹ç¾åœ¨å¹¾é»</div>
    </div>

    <div class="controls">
        <button onclick="setStartPoint()" id="btn-trace" class="btn-orange">ğŸš© è¨­å®šèµ·é»</button>
        <button onclick="toggle24Hour()" id="btn-24h" class="btn-purple">é¡¯ç¤º 24 æ™‚åˆ¶</button>
        <button onclick="toggleAllMasks()" class="btn-red">ğŸ™ˆ å…¨éƒ¨é®ä½</button>
    </div>

    <div class="controls">
        <button onclick="clearTrace()" class="btn-gray">æ¸…é™¤è»Œè·¡</button>
        <button onclick="jumpMinute(1)">+1åˆ†</button>
        <button onclick="jumpMinute(5)">+5åˆ†</button>
        <button onclick="jumpHour(1)">+1æ™‚</button>
    </div>

    <!-- å‡ºé¡Œå€ (è‡ªå‹•å…¨é¸ + å¤§æ•¸å­—éµç›¤) -->
    <div class="teacher-panel">
        <span>å‡ºé¡Œï¼š</span>
        <input type="number" id="input-h" min="1" max="12" value="9" 
               inputmode="numeric" pattern="[0-9]*" 
               onclick="this.select();" onfocus="this.select();">
        <span>é»</span>
        <input type="number" id="input-m" min="0" max="59" value="00" 
               inputmode="numeric" pattern="[0-9]*" 
               onclick="this.select();" onfocus="this.select();">
        <span>åˆ†</span>
        <button onclick="setTimeManually()" class="btn-red">è®Šèº« âœ¨</button>
    </div>
    
    <p class="helper-text">iPad æ©«æ”¾æˆ–ç›´æ”¾éƒ½å¯ä»¥æ“ä½œå–”ï¼</p>

    <script>
        const canvas = document.getElementById('clock');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('clock-container');
        const digitalDisplay = document.getElementById('digital-time');
        const diffBox = document.getElementById('diff-box');
        const diffText = document.getElementById('diff-text');
        const diffMask = document.getElementById('diff-mask');
        const timeMask = document.getElementById('time-mask');
        const btnTrace = document.getElementById('btn-trace');
        const btn24h = document.getElementById('btn-24h');
        
        let centerX, centerY, radius;
        let scale = 1;

        let minutes = 720; 
        let isDragging = false;
        let startMinutes = -1;
        let show24Hour = false;

        function resizeClock() {
            // å®‰å…¨æ©Ÿåˆ¶ï¼šå¦‚æœæŠ“ä¸åˆ°å¯¬åº¦ï¼Œé è¨­ç”¨ 340 (ç¢ºä¿ä¸æœƒè®Šæˆ 0)
            let size = container.clientWidth || 340;
            
            // è¨­å®š Canvas è§£æåº¦
            canvas.width = size;
            canvas.height = size;
            
            // è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹
            scale = size / 340;
            
            centerX = canvas.width / 2;
            centerY = canvas.height / 2;
            radius = canvas.width / 2 - (35 * scale);
            
            drawClock();
        }

        // ç›£è½è¦–çª—å¤§å°æ”¹è®Š
        window.addEventListener('resize', resizeClock);

        function drawClock() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (startMinutes !== -1) {
                drawSector();
                updateDiffBox();
            } else {
                diffBox.style.display = 'none';
            }

            // 1. ç•«åˆ»åº¦
            for (let i = 0; i < 60; i++) {
                const angle = (i * 6 - 90) * (Math.PI / 180);
                const isHour = i % 5 === 0;
                const tickLen = (isHour ? 15 : 8) * scale; 
                const startX = centerX + Math.cos(angle) * (radius - tickLen);
                const startY = centerY + Math.sin(angle) * (radius - tickLen);
                const endX = centerX + Math.cos(angle) * radius;
                const endY = centerY + Math.sin(angle) * radius;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.strokeStyle = isHour ? '#2c3e50' : '#bdc3c7';
                ctx.lineWidth = (isHour ? 4 : 2) * scale;
                ctx.stroke();
            }

            // 2. ç•«ä¸»æ•¸å­— (1-12)
            ctx.font = `bold ${26 * scale}px Arial`;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillStyle = "#2c3e50";
            for (let i = 1; i <= 12; i++) {
                const angle = (i * 30 - 90) * (Math.PI / 180);
                const dist = radius - (40 * scale);
                const x = centerX + Math.cos(angle) * dist;
                const y = centerY + Math.sin(angle) * dist;
                ctx.fillText(i, x, y);
            }

            // 3. ç•« 24 å°æ™‚åˆ¶æ•¸å­— (13-24)
            if (show24Hour) {
                ctx.font = `bold ${16 * scale}px Arial`; // ç¨å¾®èª¿å°ä¸€é»å­—é«”
                ctx.fillStyle = "#d81b60"; // ç²‰ç´…è‰²
                for (let i = 1; i <= 12; i++) {
                    const angle = (i * 30 - 90) * (Math.PI / 180);
                    const dist = radius - (85 * scale); // å…§åœˆä½ç½®
                    const x = centerX + Math.cos(angle) * dist;
                    const y = centerY + Math.sin(angle) * dist;
                    let num = i + 12;
                    ctx.fillText(num, x, y);
                }
            }

            // 4. ç•«å¤–åœˆåˆ†é˜è¼”åŠ©
            ctx.font = `${14 * scale}px Arial`;
            ctx.fillStyle = "#e67e22";
            for (let i = 1; i <= 12; i++) {
                const angle = (i * 30 - 90) * (Math.PI / 180);
                const dist = radius + (20 * scale);
                const x = centerX + Math.cos(angle) * dist;
                const y = centerY + Math.sin(angle) * dist;
                ctx.fillText(i * 5, x, y);
            }

            const hourAngle = ((minutes / 720) * 360 - 90) * (Math.PI / 180);
            const minuteAngle = (((minutes % 60) / 60) * 360 - 90) * (Math.PI / 180);

            // 5. ç•«æŒ‡é‡
            if (startMinutes !== -1) {
                const startMinAngle = (((startMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
                drawHand(startMinAngle, radius * 0.8, "rgba(52, 152, 219, 0.2)", 5 * scale); 
            }

            drawHand(hourAngle, radius * 0.5, "#e74c3c", 8 * scale);
            drawHand(minuteAngle, radius * 0.8, "#3498db", 5 * scale);

            // ä¸­å¿ƒé»
            ctx.beginPath();
            ctx.arc(centerX, centerY, 8 * scale, 0, 2 * Math.PI);
            ctx.fillStyle = "#333";
            ctx.fill();

            updateDigital();
        }

        function drawSector() {
            let startAng = (((startMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
            let endAng = (((minutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
            let counterClockwise = (minutes - startMinutes) < 0;

            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, startAng, endAng, counterClockwise); 
            ctx.fillStyle = "rgba(241, 196, 15, 0.4)";
            ctx.fill();
        }

        function drawHand(angle, length, color, width) {
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + Math.cos(angle) * length, centerY + Math.sin(angle) * length);
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.lineCap = "round";
            ctx.stroke();
        }

        function updateDigital() {
            let h = Math.floor(minutes / 60);
            if (h === 0) h = 12;
            if (h > 12) h = h % 12;
            if (h === 0) h = 12;
            const m = Math.floor(minutes % 60);
            digitalDisplay.innerText = `${h}:${m < 10 ? '0' + m : m}`;
        }

        function updateDiffBox() {
            diffBox.style.display = 'block';
            let diff = Math.abs(minutes - startMinutes);
            let bigGrid = Math.floor(diff / 5);
            let smallGrid = diff % 5;
            
            let text = `${diff} åˆ†é˜`;
            if (diff >= 5) {
                text += ` (${bigGrid} å¤§æ ¼`;
                if (smallGrid > 0) text += ` ${smallGrid} å°æ ¼`;
                text += `)`;
            } else {
                 text += ` (${smallGrid} å°æ ¼)`;
            }
            diffText.innerText = text;
        }

        function toggle24Hour() {
            show24Hour = !show24Hour;
            btn24h.innerText = show24Hour ? "éš±è— 24 æ™‚åˆ¶" : "é¡¯ç¤º 24 æ™‚åˆ¶";
            if(show24Hour) {
                btn24h.classList.add("active-mode");
            } else {
                btn24h.classList.remove("active-mode");
            }
            drawClock();
        }

        function handleInteraction(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const x = clientX - rect.left - centerX;
            const y = clientY - rect.top - centerY;
            
            let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
            if (angle < 0) angle += 360;

            let currentHour = Math.floor(minutes / 60);
            let newMinutes = Math.round((angle / 360) * 60);
            if (newMinutes === 60) newMinutes = 0;
            
            const oldMin = minutes % 60;
            if (oldMin > 45 && newMinutes < 15) currentHour++;
            if (oldMin < 15 && newMinutes > 45) currentHour--;
            
            if (currentHour < 0) currentHour += 12;
            
            minutes = currentHour * 60 + newMinutes;
            drawClock();
        }

        function setStartPoint() {
            if (startMinutes === -1) {
                startMinutes = minutes;
                btnTrace.innerText = "âŒ å–æ¶ˆèµ·é»";
                btnTrace.classList.add("active-mode");
                diffMask.style.display = "none";
            } else {
                clearTrace();
            }
            drawClock();
        }

        function clearTrace() {
            startMinutes = -1;
            btnTrace.innerText = "ğŸš© è¨­å®šèµ·é»";
            btnTrace.classList.remove("active-mode");
            diffBox.style.display = "none";
            drawClock();
        }

        function toggleTimeMask() {
            timeMask.style.display = timeMask.style.display === "flex" ? "none" : "flex";
        }
        
        function toggleDiffMask() {
            diffMask.style.display = diffMask.style.display === "flex" ? "none" : "flex";
        }

        function toggleAllMasks() {
            const isAnyOpen = timeMask.style.display === "flex" || (diffBox.style.display === "block" && diffMask.style.display === "flex");
            if (isAnyOpen) {
                timeMask.style.display = "none";
                diffMask.style.display = "none";
            } else {
                timeMask.style.display = "flex";
                if (diffBox.style.display === "block") diffMask.style.display = "flex";
            }
        }

        function jumpMinute(val) { minutes += val; drawClock(); }
        function jumpHour(val) { minutes += val * 60; drawClock(); }
        
        function setTimeManually() {
            const h = parseInt(document.getElementById('input-h').value);
            const m = parseInt(document.getElementById('input-m').value);
            if (h >= 1 && h <= 12 && m >= 0 && m <= 59) {
                let targetH = h === 12 ? 0 : h; 
                let currentCycle = Math.floor(minutes / 720);
                minutes = currentCycle * 720 + targetH * 60 + m;
                clearTrace();
                drawClock();
            } else {
                alert("è«‹è¼¸å…¥æ­£ç¢ºçš„æ™‚é–“å–”ï¼(1-12é», 0-59åˆ†)");
            }
        }

        canvas.addEventListener('mousedown', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mousemove', (e) => { if (isDragging) handleInteraction(e); });
        canvas.addEventListener('touchstart', (e) => { isDragging = true; handleInteraction(e); e.preventDefault(); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { if (isDragging) handleInteraction(e); e.preventDefault(); }, {passive: false});
        canvas.addEventListener('touchend', () => isDragging = false);

        // --- ä¿®æ­£é—œéµï¼šåˆå§‹åŒ–èˆ‡å»¶é²é‡ç¹ª ---
        resizeClock();
        
        // å¤šåŠ ä¸€å€‹å»¶é²ï¼Œç¢ºä¿ iPad æ’ç‰ˆå®Œæˆå¾Œå†ç•«ä¸€æ¬¡
        setTimeout(resizeClock, 200);
    </script>
</body>
</html>