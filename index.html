<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°äºŒæ•¸å­¸ï¼šæ™‚é–“ç·´ç¿’æ©Ÿï¼ˆèª²æœ¬åŠ å¼·ç‰ˆï¼‰</title>
    <style>
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #fffbf0; /* é…åˆèª²æœ¬çš„æº«æš–è‰²èª¿ */
            touch-action: none;
            overflow: hidden;
        }

        h1 { 
            color: #d35400; 
            margin: 10px 0; 
            font-size: 1.5rem;
        }

        #clock-container {
            position: relative;
            width: 340px;
            height: 340px;
            margin-bottom: 20px;
        }

        canvas {
            background: white;
            border-radius: 50%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            border: 8px solid #f39c12; /* åƒèª²æœ¬æ™‚é˜çš„é‚Šæ¡† */
            cursor: pointer;
            touch-action: none;
        }

        /* æ§åˆ¶é¢æ¿å€ */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            width: 90%;
        }

        button {
            padding: 10px 15px;
            font-size: 1rem;
            border: none;
            border-radius: 20px;
            background-color: #3498db;
            color: white;
            box-shadow: 0 4px 0 #2980b9;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        button.secondary { background-color: #95a5a6; box-shadow: 0 4px 0 #7f8c8d; }
        button.highlight { background-color: #e74c3c; box-shadow: 0 4px 0 #c0392b; }
        button.active-mode { background-color: #27ae60; box-shadow: 0 4px 0 #219150; border: 2px solid yellow; }

        /* æ•¸ä½æ™‚é–“é¡¯ç¤ºå€ */
        #digital-box {
            position: relative;
            width: 200px;
            height: 60px;
            background: #2c3e50;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
            cursor: pointer;
        }

        #digital-time {
            font-size: 2.5rem;
            color: #ecf0f1;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        /* é®ç½© */
        #mask {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #34495e;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #bdc3c7;
            font-size: 1.2rem;
            display: none; /* é è¨­ä¸é¡¯ç¤º */
        }
        
        .helper-text {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>ğŸ•’ å¿«æ¨‚å­¸æ™‚é˜</h1>
    
    <div id="clock-container">
        <canvas id="clock" width="340" height="340"></canvas>
    </div>

    <!-- æ§åˆ¶æŒ‰éˆ•å€ -->
    <div class="controls">
        <button onclick="setStartPoint()" id="btn-trace" class="highlight">è¨­å®šèµ·é»</button>
        <button onclick="clearTrace()" class="secondary">æ¸…é™¤è»Œè·¡</button>
        <button onclick="toggleMask()" id="btn-mask">é®ä½ç­”æ¡ˆ</button>
    </div>

    <div class="controls">
        <button onclick="jumpMinute(1)">+1åˆ†</button>
        <button onclick="jumpMinute(5)">+5åˆ†</button>
        <button onclick="jumpHour(1)">+1æ™‚</button>
    </div>

    <!-- ç­”æ¡ˆé¡¯ç¤ºå€ -->
    <div id="digital-box" onclick="toggleMask()">
        <span id="digital-time">12:00</span>
        <div id="mask">é»æ“Šçœ‹ç­”æ¡ˆ</div>
    </div>
    
    <p class="helper-text">æ‹–å‹•é•·é‡ï¼Œæˆ–æ˜¯é»æŒ‰éˆ•ä¾†ç·´ç¿’ï¼<br>é»é¸ã€Œè¨­å®šèµ·é»ã€å¯ä»¥çœ‹èµ°äº†å¤šä¹…å–”ã€‚</p>

    <script>
        const canvas = document.getElementById('clock');
        const ctx = canvas.getContext('2d');
        const digitalDisplay = document.getElementById('digital-time');
        const maskObj = document.getElementById('mask');
        const btnTrace = document.getElementById('btn-trace');
        
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = canvas.width / 2 - 35; // ç•™ç©ºé–“çµ¦å¤–åœˆæ•¸å­—

        let minutes = 0; // 0:00 æ˜¯ 0, 12:00 æ˜¯ 720
        let isDragging = false;
        
        // æ•™å­¸è¼”åŠ©è®Šæ•¸
        let startMinutes = -1; // -1 ä»£è¡¨æ²’æœ‰è¨­å®šèµ·é»

        function drawClock() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 0. å¦‚æœæœ‰è¨­å®šèµ·é»ï¼Œç•«æ‰‡å½¢é™°å½± (èª²æœ¬é‡é»)
            if (startMinutes !== -1) {
                drawSector();
            }

            // 1. ç•«é˜é¢å¤–åœˆåˆ»åº¦
            for (let i = 0; i < 60; i++) {
                const angle = (i * 6 - 90) * (Math.PI / 180);
                const isHour = i % 5 === 0;
                // å¤§æ ¼é•·ä¸€é»ï¼Œå°æ ¼çŸ­ä¸€é»
                const tickLen = isHour ? 15 : 8; 
                const startX = centerX + Math.cos(angle) * (radius - tickLen);
                const startY = centerY + Math.sin(angle) * (radius - tickLen);
                const endX = centerX + Math.cos(angle) * radius;
                const endY = centerY + Math.sin(angle) * radius;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.strokeStyle = isHour ? '#2c3e50' : '#bdc3c7';
                ctx.lineWidth = isHour ? 4 : 2;
                ctx.stroke();
            }

            // 2. ç•«é˜é¢æ•¸å­— (1-12)
            ctx.font = "bold 26px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillStyle = "#2c3e50";
            for (let i = 1; i <= 12; i++) {
                const angle = (i * 30 - 90) * (Math.PI / 180);
                const x = centerX + Math.cos(angle) * (radius - 40);
                const y = centerY + Math.sin(angle) * (radius - 40);
                ctx.fillText(i, x, y);
            }

            // 3. ç•«å¤–åœˆåˆ†é˜æç¤º (5, 10, 15...) - é€™æ˜¯èª²æœ¬æ²’å¯«ä½†å¾ˆé‡è¦çš„è¼”åŠ©
            ctx.font = "14px Arial";
            ctx.fillStyle = "#e67e22"; // æ©˜è‰²ï¼Œåƒèª²æœ¬çš„æ¨™è¨˜
            for (let i = 1; i <= 12; i++) {
                const angle = (i * 30 - 90) * (Math.PI / 180);
                // ç•«åœ¨æ¯”åŠå¾‘æ›´å¤§çš„åœ°æ–¹
                const x = centerX + Math.cos(angle) * (radius + 20);
                const y = centerY + Math.sin(angle) * (radius + 20);
                ctx.fillText(i * 5, x, y);
            }

            // è¨ˆç®—æŒ‡é‡è§’åº¦
            const hourAngle = ((minutes / 720) * 360 - 90) * (Math.PI / 180);
            const minuteAngle = (((minutes % 60) / 60) * 360 - 90) * (Math.PI / 180);

            // 4. ç•«èµ·é»çš„ã€Œé¬¼å½±æŒ‡é‡ã€ (å¦‚æœæœ‰è¨­å®š)
            if (startMinutes !== -1) {
                const startMinAngle = (((startMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
                const startHourAngle = ((startMinutes / 720) * 360 - 90) * (Math.PI / 180);
                drawHand(startHourAngle, radius * 0.5, "rgba(231, 76, 60, 0.3)", 8); // åŠé€æ˜ç´…
                drawHand(startMinAngle, radius * 0.8, "rgba(52, 152, 219, 0.3)", 5); // åŠé€æ˜è—
            }

            // 5. ç•«çŸ­é‡ (æ™‚é‡ - ç´…è‰²)
            drawHand(hourAngle, radius * 0.5, "#e74c3c", 8);

            // 6. ç•«é•·é‡ (åˆ†é‡ - è—è‰²)
            drawHand(minuteAngle, radius * 0.8, "#3498db", 5);

            // 7. ç•«ä¸­å¿ƒé»
            ctx.beginPath();
            ctx.arc(centerX, centerY, 8, 0, 2 * Math.PI);
            ctx.fillStyle = "#333";
            ctx.fill();

            updateDigital();
        }

        function drawSector() {
            // è¨ˆç®—èµ·é»å’Œçµ‚é»çš„åˆ†é‡è§’åº¦
            let startAng = (((startMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
            let endAng = (((minutes % 60) / 60) * 360 - 90) * (Math.PI / 180);

            // ç‚ºäº†ç•«å‡ºæ¼‚äº®çš„æ‰‡å½¢ï¼Œéœ€è¦åˆ¤æ–·é †æ™‚é‡æ–¹å‘
            // é€™è£¡åšä¸€å€‹ç°¡å–®çš„è™•ç†ï¼šå‡è¨­ç¸½æ˜¯ç•«ã€Œé€™å…©é»ä¹‹é–“çš„æ‰‡å½¢ã€
            // èª²æœ¬çš„æ‰‡å½¢é€šå¸¸æ˜¯é»ƒè‰²åŠé€æ˜
            
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, startAng, endAng, false); 
            ctx.fillStyle = "rgba(241, 196, 15, 0.4)"; // èª²æœ¬çš„é»ƒè‰²
            ctx.fill();
        }

        function drawHand(angle, length, color, width) {
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + Math.cos(angle) * length, centerY + Math.sin(angle) * length);
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.lineCap = "round";
            ctx.stroke();
        }

        function updateDigital() {
            let h = Math.floor(minutes / 60);
            if (h === 0) h = 12;
            if (h > 12) h = h - 12;
            const m = Math.floor(minutes % 60);
            digitalDisplay.innerText = `${h}:${m < 10 ? '0' + m : m}`;
        }

        // --- äº’å‹•èˆ‡é‚è¼¯å€ ---

        function handleInteraction(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const x = clientX - rect.left - centerX;
            const y = clientY - rect.top - centerY;
            
            let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
            if (angle < 0) angle += 360;

            let currentHour = Math.floor(minutes / 60);
            let newMinutes = Math.round((angle / 360) * 60);
            
            if (newMinutes === 60) newMinutes = 0;
            
            const oldMin = minutes % 60;
            if (oldMin > 45 && newMinutes < 15) currentHour++;
            if (oldMin < 15 && newMinutes > 45) currentHour--;
            
            if (currentHour < 0) currentHour = 11;
            if (currentHour >= 12) currentHour = 0;

            minutes = currentHour * 60 + newMinutes;
            
            // ç¢ºä¿ minutes ä¸æœƒè®Šæˆè² æ•¸ (é›–ç„¶é‚è¼¯ä¸Šå¾ˆé›£)
            if(minutes < 0) minutes += 720;
            
            drawClock();
        }

        // åŠŸèƒ½æŒ‰éˆ•é‚è¼¯
        function setStartPoint() {
            if (startMinutes === -1) {
                startMinutes = minutes; // é–å®šç›®å‰æ™‚é–“ç‚ºèµ·é»
                btnTrace.innerText = "å–æ¶ˆèµ·é»";
                btnTrace.classList.add("active-mode");
            } else {
                startMinutes = -1; // å–æ¶ˆ
                btnTrace.innerText = "è¨­å®šèµ·é»";
                btnTrace.classList.remove("active-mode");
            }
            drawClock();
        }

        function clearTrace() {
            startMinutes = -1;
            btnTrace.innerText = "è¨­å®šèµ·é»";
            btnTrace.classList.remove("active-mode");
            drawClock();
        }

        function toggleMask() {
            if (maskObj.style.display === "flex") {
                maskObj.style.display = "none";
                document.getElementById('btn-mask').innerText = "é®ä½ç­”æ¡ˆ";
            } else {
                maskObj.style.display = "flex";
                document.getElementById('btn-mask').innerText = "é¡¯ç¤ºç­”æ¡ˆ";
            }
        }

        function jumpMinute(val) {
            minutes += val;
            drawClock();
        }
        
        function jumpHour(val) {
            minutes += val * 60;
            drawClock();
        }

        // äº‹ä»¶ç›£è½
        canvas.addEventListener('mousedown', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mousemove', (e) => {
            if (isDragging) handleInteraction(e);
        });

        canvas.addEventListener('touchstart', (e) => {
            isDragging = true;
            handleInteraction(e);
            e.preventDefault();
        }, {passive: false});

        canvas.addEventListener('touchmove', (e) => {
            if (isDragging) handleInteraction(e);
            e.preventDefault();
        }, {passive: false});

        canvas.addEventListener('touchend', () => isDragging = false);

        // åˆå§‹åŒ–
        minutes = 720; // è®“å®ƒå¾ 12:00 é–‹å§‹
        drawClock();
    </script>
</body>
</html>