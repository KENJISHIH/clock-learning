<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°äºŒæ•¸å­¸ï¼šæ™‚é–“å¤§å¸«ï¼ˆå®Œç¾é‚è¼¯ç‰ˆï¼‰</title>
    <style>
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            padding-top: 20px;
            padding-bottom: 40px;
            background-color: #fffbf0;
            touch-action: pan-y;
        }

        h1 { color: #d35400; margin: 0 0 15px 0; font-size: 1.5rem; }

        /* è³‡è¨Šé¢æ¿å€ */
        #diff-box {
            position: relative;
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.2rem;
            min-width: 180px;
            text-align: center;
            display: none;
            cursor: pointer;
            box-shadow: 0 4px 0 #1e8449;
            margin-bottom: 15px;
        }

        /* æ™‚é˜å®¹å™¨ */
        #clock-container {
            position: relative;
            width: 340px;
            height: 340px;
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        canvas {
            background: white;
            border-radius: 50%;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border: 8px solid #f39c12;
            cursor: pointer;
            touch-action: none;
            width: 100%;
            height: 100%;
        }

        /* æ§åˆ¶æŒ‰éˆ•å€ */
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            width: 95%;
            max-width: 800px;
        }

        button {
            padding: 10px 16px;
            font-size: 1rem;
            border: none;
            border-radius: 15px;
            background-color: #3498db;
            color: white;
            box-shadow: 0 4px 0 #2980b9;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
            transition: all 0.2s;
        }

        button:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-red { background-color: #e74c3c; box-shadow: 0 4px 0 #c0392b; }
        .btn-gray { background-color: #95a5a6; box-shadow: 0 4px 0 #7f8c8d; }
        .btn-orange { background-color: #e67e22; box-shadow: 0 4px 0 #d35400; }
        .btn-purple { background-color: #9b59b6; box-shadow: 0 4px 0 #8e44ad; }
        
        .btn-am { background-color: #f1c40f; color: #2c3e50; box-shadow: 0 4px 0 #f39c12; }
        .btn-pm { background-color: #2c3e50; color: #f1c40f; box-shadow: 0 4px 0 #1a252f; }

        button.active-mode { 
            background-color: #27ae60; 
            box-shadow: 0 4px 0 #219150; 
            border: 2px solid #f1c40f; 
        }

        /* æ•¸ä½æ™‚é–“é¡¯ç¤ºå€ */
        #digital-box {
            position: relative;
            width: 340px;
            height: 90px;
            background: #2c3e50;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        #digital-time {
            font-size: 3.5rem;
            color: #ecf0f1;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        #ampm-tag {
            position: absolute;
            left: 25px;
            font-size: 1.2rem;
            color: #f1c40f;
            font-weight: bold;
            transition: opacity 0.3s;
        }

        .mask {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #34495e;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #bdc3c7;
            font-size: 1.1rem;
            display: none;
        }
        
        .teacher-panel {
            background: #fff;
            padding: 15px 25px;
            border-radius: 20px;
            border: 2px dashed #bdc3c7;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .teacher-panel span { font-weight: bold; color: #7f8c8d; font-size: 1.2rem; }
        
        input[type="number"] {
            width: 60px;
            padding: 8px;
            font-size: 1.4rem;
            text-align: center;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            color: #2c3e50;
            font-weight: bold;
        }

        .helper-text { color: #7f8c8d; font-size: 1rem; margin-top: 15px; text-align: center; }

        @media (min-width: 768px) {
            h1 { font-size: 2rem; margin-bottom: 25px; }
            #clock-container { width: 600px; height: 600px; }
            button { padding: 15px 25px; font-size: 1.3rem; border-radius: 20px; }
            #digital-box { width: 400px; height: 110px; }
            #digital-time { font-size: 4.5rem; }
            #ampm-tag { font-size: 1.5rem; left: 35px; }
            #diff-box { font-size: 1.5rem; padding: 15px 30px; }
            .teacher-panel { transform: scale(1.1); margin-top: 30px; }
        }
    </style>
</head>
<body>

    <h1>ğŸ•’ æ™‚é–“å¤§å¸«</h1>

    <div id="diff-box" onclick="toggleDiffMask()">
        <span id="diff-text">0 åˆ†é˜</span>
        <div id="diff-mask" class="mask">é»æˆ‘çœ‹ç¶“éå¤šä¹…</div>
    </div>
    
    <div id="clock-container">
        <canvas id="clock"></canvas>
    </div>

    <div id="digital-box" onclick="toggleTimeMask()">
        <div id="ampm-tag">ä¸Šåˆ</div>
        <span id="digital-time">12:00</span>
        <div id="time-mask" class="mask">é»æˆ‘çœ‹ç¾åœ¨å¹¾é»</div>
    </div>

    <div class="controls">
        <!-- ç§»é™¤æ‰‹å‹•åˆ‡æ› AM/PM æŒ‰éˆ•ï¼Œæ”¹ç‚ºé»æ“Šæœƒè·³è½‰ 12 å°æ™‚ -->
        <button onclick="jumpHour(12)" id="btn-ampm" class="btn-am">ğŸŒ¤ ä¸Šåˆ</button>
        <button onclick="toggle24Hour()" id="btn-24h" class="btn-purple">é¡¯ç¤º 24 æ™‚åˆ¶</button>
        <button onclick="toggleAllMasks()" class="btn-red">ğŸ™ˆ å…¨éƒ¨é®ä½</button>
    </div>

    <div class="controls">
        <button onclick="setStartPoint()" id="btn-trace" class="btn-orange">ğŸš© è¨­å®šèµ·é»</button>
        <button onclick="clearTrace()" class="btn-gray">æ¸…é™¤è»Œè·¡</button>
        <button onclick="jumpMinute(1)">+1åˆ†</button>
        <button onclick="jumpMinute(5)">+5åˆ†</button>
        <button onclick="jumpHour(1)">+1æ™‚</button> 
    </div>

    <div class="teacher-panel">
        <span>å‡ºé¡Œï¼š</span>
        <input type="number" id="input-h" min="0" max="23" value="9" 
               inputmode="numeric" pattern="[0-9]*" 
               onclick="this.select();" onfocus="this.select();">
        <span>é»</span>
        <input type="number" id="input-m" min="0" max="59" value="00" 
               inputmode="numeric" pattern="[0-9]*" 
               onclick="this.select();" onfocus="this.select();">
        <span>åˆ†</span>
        <button onclick="setTimeManually()" class="btn-red">è®Šèº« âœ¨</button>
    </div>
    
    <p class="helper-text">iPad æ©«æ”¾æˆ–ç›´æ”¾éƒ½å¯ä»¥æ“ä½œå–”ï¼</p>

    <script>
        const canvas = document.getElementById('clock');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('clock-container');
        const digitalDisplay = document.getElementById('digital-time');
        const ampmTag = document.getElementById('ampm-tag');
        const diffBox = document.getElementById('diff-box');
        const diffText = document.getElementById('diff-text');
        const diffMask = document.getElementById('diff-mask');
        const timeMask = document.getElementById('time-mask');
        const btnTrace = document.getElementById('btn-trace');
        const btn24h = document.getElementById('btn-24h');
        const btnAmPm = document.getElementById('btn-ampm');
        
        let centerX, centerY, radius;
        let scale = 1;

        // æ ¸å¿ƒæ”¹è®Šï¼šç¾åœ¨ totalMinutes ç¯„åœæ˜¯ 0 ~ 1439 (24å°æ™‚)
        // 0 = 00:00, 720 = 12:00, 1439 = 23:59
        let totalMinutes = 720; // é è¨­ 12:00 (ä¸­åˆ)
        
        let isDragging = false;
        let startMinutes = -1;
        let show24Hour = false;

        function resizeClock() {
            let size = container.clientWidth || 340;
            canvas.width = size;
            canvas.height = size;
            scale = size / 340;
            centerX = canvas.width / 2;
            centerY = canvas.height / 2;
            radius = canvas.width / 2 - (35 * scale);
            drawClock();
        }

        window.addEventListener('resize', resizeClock);

        function drawClock() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (startMinutes !== -1) {
                drawSector();
                updateDiffBox();
            } else {
                diffBox.style.display = 'none';
            }

            // 1. ç•«åˆ»åº¦
            for (let i = 0; i < 60; i++) {
                const angle = (i * 6 - 90) * (Math.PI / 180);
                const isHour = i % 5 === 0;
                const tickLen = (isHour ? 15 : 8) * scale; 
                const startX = centerX + Math.cos(angle) * (radius - tickLen);
                const startY = centerY + Math.sin(angle) * (radius - tickLen);
                const endX = centerX + Math.cos(angle) * radius;
                const endY = centerY + Math.sin(angle) * radius;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.strokeStyle = isHour ? '#2c3e50' : '#bdc3c7';
                ctx.lineWidth = (isHour ? 4 : 2) * scale;
                ctx.stroke();
            }

            // 2. ç•«ä¸»æ•¸å­— (1-12)
            ctx.font = `bold ${26 * scale}px Arial`;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillStyle = "#2c3e50";
            for (let i = 1; i <= 12; i++) {
                const angle = (i * 30 - 90) * (Math.PI / 180);
                const dist = radius - (40 * scale);
                const x = centerX + Math.cos(angle) * dist;
                const y = centerY + Math.sin(angle) * dist;
                ctx.fillText(i, x, y);
            }

            // 3. ç•« 24 å°æ™‚åˆ¶æ•¸å­— (13-24)
            // é€™è£¡ç•« 24 è€Œä¸æ˜¯ 00ï¼Œæ˜¯ç‚ºäº†é…åˆå…’ç«¥é˜é¢çš„è¦–è¦ºç¿’æ…£
            if (show24Hour) {
                ctx.font = `bold ${16 * scale}px Arial`;
                ctx.fillStyle = "#d81b60"; 
                for (let i = 1; i <= 12; i++) {
                    const angle = (i * 30 - 90) * (Math.PI / 180);
                    const dist = radius - (85 * scale); 
                    const x = centerX + Math.cos(angle) * dist;
                    const y = centerY + Math.sin(angle) * dist;
                    let num = i + 12; 
                    ctx.fillText(num, x, y);
                }
            }

            // 4. ç•«å¤–åœˆåˆ†é˜è¼”åŠ©
            ctx.font = `${14 * scale}px Arial`;
            ctx.fillStyle = "#e67e22";
            for (let i = 1; i <= 12; i++) {
                const angle = (i * 30 - 90) * (Math.PI / 180);
                const dist = radius + (20 * scale);
                const x = centerX + Math.cos(angle) * dist;
                const y = centerY + Math.sin(angle) * dist;
                ctx.fillText(i * 5, x, y);
            }

            const hourAngle = ((totalMinutes / 720) * 360 - 90) * (Math.PI / 180);
            const minuteAngle = (((totalMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);

            // 5. ç•«æŒ‡é‡
            if (startMinutes !== -1) {
                // é€™è£¡è¦è™•ç† startMinutes çš„é¡¯ç¤ºé‚è¼¯
                const startMinAngle = (((startMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
                drawHand(startMinAngle, radius * 0.8, "rgba(52, 152, 219, 0.2)", 5 * scale); 
            }

            drawHand(hourAngle, radius * 0.5, "#e74c3c", 8 * scale);
            drawHand(minuteAngle, radius * 0.8, "#3498db", 5 * scale);

            // ä¸­å¿ƒé»
            ctx.beginPath();
            ctx.arc(centerX, centerY, 8 * scale, 0, 2 * Math.PI);
            ctx.fillStyle = "#333";
            ctx.fill();

            updateDigital();
        }

        function drawSector() {
            // åªç•«åˆ†é˜çš„å·®ç•°
            let startAng = (((startMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
            let endAng = (((totalMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
            
            // åˆ¤æ–·ç¹ªè£½æ–¹å‘ (å¦‚æœç¾åœ¨çš„æ™‚é–“å°æ–¼èµ·é»ï¼Œå°±é€†æ™‚é‡ç•«)
            // é€™è£¡æˆ‘å€‘ç”¨ç¸½åˆ†é˜æ•¸çš„å·®å€¼ä¾†åˆ¤æ–·
            let diff = totalMinutes - startMinutes;
            let counterClockwise = diff < 0;

            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, startAng, endAng, counterClockwise); 
            ctx.fillStyle = "rgba(241, 196, 15, 0.4)";
            ctx.fill();
        }

        function drawHand(angle, length, color, width) {
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + Math.cos(angle) * length, centerY + Math.sin(angle) * length);
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.lineCap = "round";
            ctx.stroke();
        }

        function updateDigital() {
            let h = Math.floor(totalMinutes / 60); // 0 ~ 23
            let m = Math.floor(totalMinutes % 60);
            
            // åˆ¤æ–·ä¸Šä¸‹åˆ
            let isPM = h >= 12;
            
            // æ›´æ–° UI ç‹€æ…‹ (æŒ‰éˆ•é¡è‰²)
            if (isPM) {
                btnAmPm.innerHTML = "ğŸŒ™ ä¸‹åˆ";
                btnAmPm.className = "btn-pm";
                ampmTag.innerText = "ä¸‹åˆ";
            } else {
                btnAmPm.innerHTML = "ğŸŒ¤ ä¸Šåˆ";
                btnAmPm.className = "btn-am";
                ampmTag.innerText = "ä¸Šåˆ";
            }

            // é¡¯ç¤ºé‚è¼¯
            if (show24Hour) {
                // 24å°æ™‚åˆ¶ï¼šç›´æ¥é¡¯ç¤º h (00 ~ 23)
                // é€™è£¡ä¿®å¾©äº† 24:57 çš„å•é¡Œï¼Œç¾åœ¨åˆå¤œæ˜¯ 00:xx
                ampmTag.style.opacity = '0';
                digitalDisplay.innerText = `${h < 10 ? '0'+h : h}:${m < 10 ? '0' + m : m}`;
            } else {
                // 12å°æ™‚åˆ¶ï¼š0 é»è®Š 12 é»ï¼Œ13 é»è®Š 1 é»
                ampmTag.style.opacity = '1';
                let displayH = h % 12;
                if (displayH === 0) displayH = 12;
                digitalDisplay.innerText = `${displayH}:${m < 10 ? '0' + m : m}`;
            }
        }

        function updateDiffBox() {
            diffBox.style.display = 'block';
            let diff = Math.abs(totalMinutes - startMinutes);
            let bigGrid = Math.floor(diff / 5);
            let smallGrid = diff % 5;
            
            let text = `${diff} åˆ†é˜`;
            if (diff >= 5) {
                text += ` (${bigGrid} å¤§æ ¼`;
                if (smallGrid > 0) text += ` ${smallGrid} å°æ ¼`;
                text += `)`;
            } else {
                 text += ` (${smallGrid} å°æ ¼)`;
            }
            diffText.innerText = text;
        }

        function toggle24Hour() {
            show24Hour = !show24Hour;
            btn24h.innerText = show24Hour ? "éš±è— 24 æ™‚åˆ¶" : "é¡¯ç¤º 24 æ™‚åˆ¶";
            if(show24Hour) {
                btn24h.classList.add("active-mode");
            } else {
                btn24h.classList.remove("active-mode");
            }
            drawClock();
        }

        function handleInteraction(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const x = clientX - rect.left - centerX;
            const y = clientY - rect.top - centerY;
            
            // è¨ˆç®—è§’åº¦ (0-360)
            let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
            if (angle < 0) angle += 360;

            // ç›®å‰çš„å°æ™‚ (0-23)
            let currentHour = Math.floor(totalMinutes / 60);
            
            // æ–°çš„åˆ†é˜æ•¸ (0-59)
            let newMinutesOnFace = Math.round((angle / 360) * 60);
            if (newMinutesOnFace === 60) newMinutesOnFace = 0;
            
            // èˆŠçš„åˆ†é˜æ•¸ (0-59)
            const oldMinutesOnFace = totalMinutes % 60;
            
            // åˆ¤æ–·æ˜¯å¦è·¨é 12 é» (é˜é¢ä¸Šçš„ 12)
            // é †æ™‚é‡ï¼šä¾‹å¦‚ 58 -> 2
            if (oldMinutesOnFace > 45 && newMinutesOnFace < 15) {
                currentHour++; 
            }
            // é€†æ™‚é‡ï¼šä¾‹å¦‚ 2 -> 58
            else if (oldMinutesOnFace < 15 && newMinutesOnFace > 45) {
                currentHour--;
            }
            
            // é€™è£¡æ˜¯æœ€é‡è¦çš„ä¿®æ­£ï¼šè™•ç† 0~23 çš„å¾ªç’°
            if (currentHour >= 24) currentHour = 0; // 23:59 -> 00:00
            if (currentHour < 0) currentHour = 23;  // 00:00 -> 23:59

            // æ›´æ–°ç¸½åˆ†é˜æ•¸
            totalMinutes = currentHour * 60 + newMinutesOnFace;
            drawClock();
        }

        function setStartPoint() {
            if (startMinutes === -1) {
                startMinutes = totalMinutes;
                btnTrace.innerText = "âŒ å–æ¶ˆèµ·é»";
                btnTrace.classList.add("active-mode");
                diffMask.style.display = "none";
            } else {
                clearTrace();
            }
            drawClock();
        }

        function clearTrace() {
            startMinutes = -1;
            btnTrace.innerText = "ğŸš© è¨­å®šèµ·é»";
            btnTrace.classList.remove("active-mode");
            diffBox.style.display = "none";
            drawClock();
        }

        function toggleTimeMask() {
            timeMask.style.display = timeMask.style.display === "flex" ? "none" : "flex";
        }
        
        function toggleDiffMask() {
            diffMask.style.display = diffMask.style.display === "flex" ? "none" : "flex";
        }

        function toggleAllMasks() {
            const isAnyOpen = timeMask.style.display === "flex" || (diffBox.style.display === "block" && diffMask.style.display === "flex");
            if (isAnyOpen) {
                timeMask.style.display = "none";
                diffMask.style.display = "none";
            } else {
                timeMask.style.display = "flex";
                if (diffBox.style.display === "block") diffMask.style.display = "flex";
            }
        }

        function jumpMinute(val) { 
            totalMinutes += val; 
            // è™•ç†è·¨æ—¥
            if (totalMinutes >= 1440) totalMinutes -= 1440;
            if (totalMinutes < 0) totalMinutes += 1440;
            drawClock(); 
        }
        
        function jumpHour(val) { 
            totalMinutes += val * 60; 
            if (totalMinutes >= 1440) totalMinutes -= 1440;
            if (totalMinutes < 0) totalMinutes += 1440;
            drawClock(); 
        }
        
        function setTimeManually() {
            const h = parseInt(document.getElementById('input-h').value);
            const m = parseInt(document.getElementById('input-m').value);
            
            if (h >= 0 && h <= 23 && m >= 0 && m <= 59) {
                totalMinutes = h * 60 + m;
                clearTrace();
                drawClock();
            } else {
                alert("è«‹è¼¸å…¥æ­£ç¢ºçš„æ™‚é–“å–”ï¼(0-23é», 0-59åˆ†)");
            }
        }

        canvas.addEventListener('mousedown', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mousemove', (e) => { if (isDragging) handleInteraction(e); });
        canvas.addEventListener('touchstart', (e) => { isDragging = true; handleInteraction(e); e.preventDefault(); }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { if (isDragging) handleInteraction(e); e.preventDefault(); }, {passive: false});
        canvas.addEventListener('touchend', () => isDragging = false);

        resizeClock();
        setTimeout(resizeClock, 200);
    </script>
</body>
</html>