<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°äºŒæ•¸å­¸ï¼šæ™‚é–“å¤§å¸«ï¼ˆå®Œæ•´ç‰ˆï¼‰</title>
    <style>
        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* æ”¹ç‚ºé ä¸Šå°é½Šï¼Œå› ç‚ºå…§å®¹è®Šå¤šäº† */
            min-height: 100vh;
            margin: 0;
            padding-top: 20px;
            padding-bottom: 40px;
            background-color: #fffbf0;
            touch-action: pan-y; /* å…è¨±å‚ç›´æ²å‹• */
        }

        h1 { color: #d35400; margin: 0 0 15px 0; font-size: 1.4rem; }

        /* è³‡è¨Šé¢æ¿å€ */
        .info-panel {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }

        /* é¡¯ç¤ºå¹¾å¤§æ ¼çš„ç›’å­ */
        #diff-box {
            position: relative;
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.2rem;
            min-width: 180px;
            text-align: center;
            display: none; /* é è¨­éš±è— */
            cursor: pointer;
            box-shadow: 0 4px 0 #1e8449;
        }

        #clock-container {
            position: relative;
            width: 340px;
            height: 340px;
            margin-bottom: 20px;
            flex-shrink: 0; /* é˜²æ­¢æ™‚é˜è¢«å£“ç¸® */
        }

        canvas {
            background: white;
            border-radius: 50%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            border: 8px solid #f39c12;
            cursor: pointer;
            touch-action: none;
        }

        /* æ§åˆ¶æŒ‰éˆ•å€ */
        .controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            justify-content: center;
            width: 95%;
        }

        button {
            padding: 8px 12px;
            font-size: 1rem;
            border: none;
            border-radius: 15px;
            background-color: #3498db;
            color: white;
            box-shadow: 0 4px 0 #2980b9;
            cursor: pointer;
            font-weight: bold;
        }

        button:active { transform: translateY(4px); box-shadow: none; }
        
        .btn-red { background-color: #e74c3c; box-shadow: 0 4px 0 #c0392b; }
        .btn-gray { background-color: #95a5a6; box-shadow: 0 4px 0 #7f8c8d; }
        .btn-orange { background-color: #e67e22; box-shadow: 0 4px 0 #d35400; }
        
        button.active-mode { 
            background-color: #27ae60; 
            box-shadow: 0 4px 0 #219150; 
            border: 2px solid #f1c40f; 
        }

        /* æ•¸ä½æ™‚é–“é¡¯ç¤ºå€ */
        #digital-box {
            position: relative;
            width: 220px;
            height: 60px;
            background: #2c3e50;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        #digital-time {
            font-size: 2.5rem;
            color: #ecf0f1;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        /* é€šç”¨é®ç½©æ¨£å¼ */
        .mask {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #34495e;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #bdc3c7;
            font-size: 1rem;
            display: none;
        }
        
        /* å‡ºé¡Œå€å¡Š */
        .teacher-panel {
            background: #fff;
            padding: 15px;
            border-radius: 20px;
            border: 2px dashed #bdc3c7;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .teacher-panel span { font-weight: bold; color: #7f8c8d; }
        
        input[type="number"] {
            width: 50px;
            padding: 8px;
            font-size: 1.2rem;
            text-align: center;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
        }

        .helper-text { color: #7f8c8d; font-size: 0.9rem; margin-top: 5px; text-align: center; }

    </style>
</head>
<body>

    <h1>ğŸ•’ æ™‚é–“å¤§å¸«</h1>

    <!-- 1. æ–°åŠŸèƒ½ï¼šç¶“éæ™‚é–“é¡¯ç¤ºå€ (ç¶ è‰²ç›’å­) -->
    <div id="diff-box" onclick="toggleDiffMask()">
        <span id="diff-text">0 åˆ†é˜</span>
        <div id="diff-mask" class="mask">é»æˆ‘çœ‹ç¶“éå¤šä¹…</div>
    </div>
    
    <div id="clock-container">
        <canvas id="clock" width="340" height="340"></canvas>
    </div>

    <!-- 2. ç­”æ¡ˆé¡¯ç¤ºå€ (è—è‰²ç›’å­) -->
    <div id="digital-box" onclick="toggleTimeMask()">
        <span id="digital-time">12:00</span>
        <div id="time-mask" class="mask">é»æˆ‘çœ‹ç¾åœ¨å¹¾é»</div>
    </div>

    <!-- æ§åˆ¶æŒ‰éˆ• -->
    <div class="controls">
        <button onclick="setStartPoint()" id="btn-trace" class="btn-orange">ğŸš© è¨­å®šèµ·é»</button>
        <button onclick="clearTrace()" class="btn-gray">æ¸…é™¤</button>
        <button onclick="toggleAllMasks()" class="btn-red">ğŸ™ˆ å…¨éƒ¨é®ä½</button>
    </div>

    <div class="controls">
        <button onclick="jumpMinute(1)">+1åˆ†</button>
        <button onclick="jumpMinute(5)">+5åˆ†</button>
        <button onclick="jumpHour(1)">+1æ™‚</button>
    </div>

    <!-- 3. æ–°åŠŸèƒ½ï¼šå‡ºé¡Œå€ -->
    <div class="teacher-panel">
        <span>å‡ºé¡Œï¼š</span>
        <input type="number" id="input-h" min="1" max="12" value="9">
        <span>é»</span>
        <input type="number" id="input-m" min="0" max="59" value="00">
        <span>åˆ†</span>
        <button onclick="setTimeManually()" class="btn-red">è®Šèº« âœ¨</button>
    </div>
    
    <p class="helper-text">iPad æ©«æ”¾æˆ–ç›´æ”¾éƒ½å¯ä»¥æ“ä½œå–”ï¼</p>

    <script>
        const canvas = document.getElementById('clock');
        const ctx = canvas.getContext('2d');
        const digitalDisplay = document.getElementById('digital-time');
        const diffBox = document.getElementById('diff-box');
        const diffText = document.getElementById('diff-text');
        const diffMask = document.getElementById('diff-mask');
        const timeMask = document.getElementById('time-mask');
        const btnTrace = document.getElementById('btn-trace');
        
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = canvas.width / 2 - 35;

        let minutes = 720; // é è¨­ 12:00
        let isDragging = false;
        let startMinutes = -1; // -1 ä»£è¡¨æœªè¨­å®šèµ·é»

        function drawClock() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. ç•«ç¶“éæ™‚é–“çš„æ‰‡å½¢ (å¦‚æœæœ‰é»é¸è¨­å®šèµ·é»)
            if (startMinutes !== -1) {
                drawSector();
                updateDiffBox(); // æ›´æ–°ä¸Šæ–¹çš„ç¶ è‰²ç›’å­æ–‡å­—
            } else {
                diffBox.style.display = 'none'; // æ²’è¨­å®šèµ·é»å°±éš±è—ç¶ è‰²ç›’å­
            }

            // 2. ç•«åˆ»åº¦
            for (let i = 0; i < 60; i++) {
                const angle = (i * 6 - 90) * (Math.PI / 180);
                const isHour = i % 5 === 0;
                const tickLen = isHour ? 15 : 8; 
                const startX = centerX + Math.cos(angle) * (radius - tickLen);
                const startY = centerY + Math.sin(angle) * (radius - tickLen);
                const endX = centerX + Math.cos(angle) * radius;
                const endY = centerY + Math.sin(angle) * radius;

                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.strokeStyle = isHour ? '#2c3e50' : '#bdc3c7';
                ctx.lineWidth = isHour ? 4 : 2;
                ctx.stroke();
            }

            // 3. ç•«æ•¸å­—
            ctx.font = "bold 26px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillStyle = "#2c3e50";
            for (let i = 1; i <= 12; i++) {
                const angle = (i * 30 - 90) * (Math.PI / 180);
                const x = centerX + Math.cos(angle) * (radius - 40);
                const y = centerY + Math.sin(angle) * (radius - 40);
                ctx.fillText(i, x, y);
            }

            // 4. ç•«å¤–åœˆè¼”åŠ©æ•¸å­— (5, 10, 15...)
            ctx.font = "14px Arial";
            ctx.fillStyle = "#e67e22";
            for (let i = 1; i <= 12; i++) {
                const angle = (i * 30 - 90) * (Math.PI / 180);
                const x = centerX + Math.cos(angle) * (radius + 20);
                const y = centerY + Math.sin(angle) * (radius + 20);
                ctx.fillText(i * 5, x, y);
            }

            // æŒ‡é‡è§’åº¦è¨ˆç®—
            const hourAngle = ((minutes / 720) * 360 - 90) * (Math.PI / 180);
            const minuteAngle = (((minutes % 60) / 60) * 360 - 90) * (Math.PI / 180);

            // 5. ç•«èµ·é»çš„é¬¼å½±æŒ‡é‡
            if (startMinutes !== -1) {
                const startMinAngle = (((startMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
                drawHand(startMinAngle, radius * 0.8, "rgba(52, 152, 219, 0.2)", 5); 
            }

            // 6. ç•«æ™‚é‡èˆ‡åˆ†é‡
            drawHand(hourAngle, radius * 0.5, "#e74c3c", 8);
            drawHand(minuteAngle, radius * 0.8, "#3498db", 5);

            // ä¸­å¿ƒé»
            ctx.beginPath();
            ctx.arc(centerX, centerY, 8, 0, 2 * Math.PI);
            ctx.fillStyle = "#333";
            ctx.fill();

            updateDigital();
        }

        function drawSector() {
            let startAng = (((startMinutes % 60) / 60) * 360 - 90) * (Math.PI / 180);
            let endAng = (((minutes % 60) / 60) * 360 - 90) * (Math.PI / 180);

            // è™•ç†è·¨è¶Š 12 é»çš„ç¹ªåœ–å•é¡Œï¼Œè®“æ‰‡å½¢ç¸½æ˜¯ç•«ã€Œè¼ƒçŸ­çš„é‚£ä¸€é‚Šã€æˆ–ã€Œé †æ™‚é‡ã€
            // ç‚ºäº†ç°¡å–®ä¸”ç¬¦åˆç›´è¦ºï¼šæˆ‘å€‘ç•«ã€Œèµ°éçš„ç—•è·¡ã€
            // é€™è£¡ä½¿ç”¨ Canvas çš„ arcï¼Œå®ƒæœƒè‡ªå‹•è™•ç†
            
            // åˆ¤æ–·é †æ™‚é‡ç•«é‚„æ˜¯é€†æ™‚é‡ç•«æ¯”è¼ƒåˆç†
            // é€™è£¡ç°¡å–®åˆ¤å®šï¼šå¦‚æœé †æ™‚é‡èµ°
            let counterClockwise = false;
            // ç¨å¾®è¤‡é›œçš„é‚è¼¯ï¼šåˆ¤æ–·æ•¸å€¼å·®ç•°
            let diff = minutes - startMinutes;
            if (diff < 0) counterClockwise = true; 

            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            // é€™è£¡ç°¡åŒ–è™•ç†ï¼šä¸ç®¡æ­£è² ï¼Œæˆ‘å€‘åªç•«è¦–è¦ºä¸Šçš„æ‰‡å½¢
            ctx.arc(centerX, centerY, radius, startAng, endAng, counterClockwise); 
            ctx.fillStyle = "rgba(241, 196, 15, 0.4)";
            ctx.fill();
        }

        function drawHand(angle, length, color, width) {
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.lineTo(centerX + Math.cos(angle) * length, centerY + Math.sin(angle) * length);
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.lineCap = "round";
            ctx.stroke();
        }

        function updateDigital() {
            let h = Math.floor(minutes / 60);
            if (h === 0) h = 12;
            if (h > 12) h = h % 12;
            if (h === 0) h = 12; // è™•ç† 12 é»æ•´é™¤å•é¡Œ
            
            const m = Math.floor(minutes % 60);
            digitalDisplay.innerText = `${h}:${m < 10 ? '0' + m : m}`;
        }

        function updateDiffBox() {
            diffBox.style.display = 'block'; // é¡¯ç¤ºç›’å­
            let diff = Math.abs(minutes - startMinutes);
            
            // è¨ˆç®—å¤§æ ¼èˆ‡å°æ ¼
            let bigGrid = Math.floor(diff / 5);
            let smallGrid = diff % 5;
            
            let text = `${diff} åˆ†é˜`;
            if (diff >= 5) {
                text += ` (${bigGrid} å¤§æ ¼`;
                if (smallGrid > 0) text += ` ${smallGrid} å°æ ¼`;
                text += `)`;
            } else {
                 text += ` (${smallGrid} å°æ ¼)`;
            }
            diffText.innerText = text;
        }

        // --- äº’å‹•é‚è¼¯ ---
        function handleInteraction(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            const x = clientX - rect.left - centerX;
            const y = clientY - rect.top - centerY;
            
            let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
            if (angle < 0) angle += 360;

            let currentHour = Math.floor(minutes / 60);
            let newMinutes = Math.round((angle / 360) * 60);
            if (newMinutes === 60) newMinutes = 0;
            
            const oldMin = minutes % 60;
            // é †æ™‚é‡é 12 é»
            if (oldMin > 45 && newMinutes < 15) currentHour++;
            // é€†æ™‚é‡é 12 é»
            if (oldMin < 15 && newMinutes > 45) currentHour--;
            
            // ä¿æŒ currentHour åœ¨åˆç†ç¯„åœ (é˜²æ­¢è² æ•¸å°è‡´é‹ç®—éŒ¯èª¤)
            if (currentHour < 0) currentHour += 12; // ç°¡å–®å¾ªç’°
            
            minutes = currentHour * 60 + newMinutes;
            drawClock();
        }

        // --- æŒ‰éˆ•åŠŸèƒ½ ---
        function setStartPoint() {
            if (startMinutes === -1) {
                startMinutes = minutes;
                btnTrace.innerText = "âŒ å–æ¶ˆèµ·é»";
                btnTrace.classList.add("active-mode");
                diffMask.style.display = "none"; // é‡ç½®é®ç½©
            } else {
                clearTrace();
            }
            drawClock();
        }

        function clearTrace() {
            startMinutes = -1;
            btnTrace.innerText = "ğŸš© è¨­å®šèµ·é»";
            btnTrace.classList.remove("active-mode");
            diffBox.style.display = "none";
            drawClock();
        }

        // é®ç½©æ§åˆ¶
        function toggleTimeMask() {
            timeMask.style.display = timeMask.style.display === "flex" ? "none" : "flex";
        }
        
        function toggleDiffMask() {
            diffMask.style.display = diffMask.style.display === "flex" ? "none" : "flex";
        }

        function toggleAllMasks() {
            // ç°¡æ˜“åˆ‡æ›ï¼šå¦‚æœæœ‰ä¸€å€‹é–‹è‘—ï¼Œå°±å…¨é—œï¼Œåä¹‹å…¨é–‹
            const isAnyOpen = timeMask.style.display === "flex" || (diffBox.style.display === "block" && diffMask.style.display === "flex");
            
            if (isAnyOpen) {
                timeMask.style.display = "none";
                diffMask.style.display = "none";
            } else {
                timeMask.style.display = "flex";
                if (diffBox.style.display === "block") diffMask.style.display = "flex";
            }
        }

        function jumpMinute(val) {
            minutes += val;
            drawClock();
        }
        
        function jumpHour(val) {
            minutes += val * 60;
            drawClock();
        }
        
        // è€å¸«å‡ºé¡Œæ¨¡å¼
        function setTimeManually() {
            const h = parseInt(document.getElementById('input-h').value);
            const m = parseInt(document.getElementById('input-m').value);
            
            if (h >= 1 && h <= 12 && m >= 0 && m <= 59) {
                // å°‡ 12 é»è¦–ç‚º 0 æˆ– 12 éƒ½å¯ä»¥ï¼Œé€™è£¡è½‰æˆ internal minutes
                let targetH = h;
                if (targetH === 12) targetH = 0; 
                // ç‚ºäº†ä¸è®“æŒ‡é‡äº‚è½‰åœˆï¼Œæˆ‘å€‘è©¦è‘—ä¿æŒåœ¨ç›®å‰çš„ 12 å°æ™‚é€±æœŸå…§
                let currentCycle = Math.floor(minutes / 720);
                minutes = currentCycle * 720 + targetH * 60 + m;
                
                // æ¸…é™¤è»Œè·¡ä»¥å…æ··æ·†
                clearTrace();
                drawClock();
            } else {
                alert("è«‹è¼¸å…¥æ­£ç¢ºçš„æ™‚é–“å–”ï¼(1-12é», 0-59åˆ†)");
            }
        }

        // äº‹ä»¶ç›£è½
        canvas.addEventListener('mousedown', () => isDragging = true);
        window.addEventListener('mouseup', () => isDragging = false);
        canvas.addEventListener('mousemove', (e) => { if (isDragging) handleInteraction(e); });

        canvas.addEventListener('touchstart', (e) => {
            isDragging = true;
            handleInteraction(e);
            e.preventDefault();
        }, {passive: false});

        canvas.addEventListener('touchmove', (e) => {
            if (isDragging) handleInteraction(e);
            e.preventDefault();
        }, {passive: false});
        
        canvas.addEventListener('touchend', () => isDragging = false);

        drawClock();
    </script>
</body>
</html>